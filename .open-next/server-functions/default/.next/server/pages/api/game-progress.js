"use strict";(()=>{var e={};e.id=619,e.ids=[619],e.modules={3480:(e,t,r)=>{e.exports=r(5600)},5580:(e,t,r)=>{r.r(t),r.d(t,{config:()=>h,default:()=>g,routeModule:()=>f});var s={};r.r(s),r.d(s,{default:()=>c});var a=r(3480),o=r(8667),n=r(6435);let i=null,l=0,u=new Map,p=new Map;async function m(e){if(i&&Date.now()-l<432e5)return i;let t=await fetch(`https://retroachievements.org/API/API_GetConsoleIDs.php?y=${encodeURIComponent(e)}&a=1&g=1`);if(!t.ok)throw Error("Failed to fetch console list");let r=await t.json(),s=new Map;return r.forEach(({ID:e,IconURL:t})=>{let r=t?.match(/\/([^\/]+)\.png$/);e&&r&&s.set(parseInt(e),r[1])}),i=s,l=Date.now(),s}async function c(e,t){if(function(e){let t=Date.now(),r=(p.get(e)||[]).filter(e=>t-e<6e4);return r.length>=5||(r.push(t),p.set(e,r),!1)}(e.headers["x-forwarded-for"]?.split(",")[0]||e.socket.remoteAddress))return t.status(429).json({error:!0,message:"Too many requests. Please try again later."});let r=process.env.RA_API_KEY,s=process.env.RA_USERNAME;if(!r||!s)return t.status(500).json({error:"Missing RA_API_KEY or RA_USERNAME in environment variables."});let a=u.get(s);if(a&&Date.now()-a.timestamp<3e5)return t.status(200).json(a.data);let o=new URLSearchParams({y:r,u:s,c:"500",o:"0"}),n=`https://retroachievements.org/API/API_GetUserCompletionProgress.php?${o}`;try{let e=await m(r),a=await fetch(n);if(!a.ok)throw Error("Failed to fetch user completion progress.");let o=await a.json(),i=await Promise.all(o.Results.map(async t=>{let a=t.GameID.toString(),o=`https://retroachievements.org/API/API_GetGameInfoAndUserProgress.php?y=${r}&u=${s}&g=${a}&a=1`,n=`https://retroachievements.org/API/API_GetGameHashes.php?y=${r}&i=${a}`,i=e=>"string"==typeof e&&e.startsWith("/")?"https://media.retroachievements.org"+e:e,l=parseInt(t.ConsoleID),u=e.has(l)?`https://static.retroachievements.org/assets/images/system/${e.get(l)}.png`:null,p={...t,ImageIcon:i(t.ImageIcon),ConsoleIcon:u};try{let[e,t]=await Promise.all([fetch(o),fetch(n)]);if(!e.ok||!t.ok)throw Error();let r=await e.json(),s=await t.json(),{ID:a,Title:l,ConsoleID:u,ConsoleName:m,ImageIcon:c,ParentGameID:g,Achievements:h,...f}=r,P={...f,ImageTitle:i(f.ImageTitle),ImageIngame:i(f.ImageIngame),ImageBoxArt:i(f.ImageBoxArt)};return{...p,Hashes:s.Results||[],UserProgress:P}}catch{return{...p,UserProgress:null,Hashes:[],error:`Failed to fetch detail/hash for GameID ${a}`}}})),l={Count:o.Count,Total:o.Total,Results:i};return u.set(s,{timestamp:Date.now(),data:l}),t.status(200).json(l)}catch(e){return console.error("Error in game-progress API:",e.message),t.status(500).json({error:"Internal server error."})}}let g=(0,n.M)(s,"default"),h=(0,n.M)(s,"config"),f=new a.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/game-progress",pathname:"/api/game-progress",bundlePath:"",filename:""},userland:s})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=5580);module.exports=r})();